angular.module("firebaseHelper",["firebase"]).service("$firebaseHelper",["$firebase",function(e){var r=this,t={};return r.$ref=function(){var e=Array.prototype.slice.call(arguments);"constants"!=e[0]&&e.unshift("data");var r="Ref"+e.join("");if(t[r])return t[r];var n=new Firebase("https://ripkit.firebaseio.com/"+(e.join("/")||""));return t[r]=n,n},r.$inst=function(){var n=Array.prototype.slice.call(arguments),a="Inst"+n.join("");if(t[a])return t[a];var o=e(r.$ref.apply(this,arguments));return t[a]=o,o},r.$get=function(){var e=Array.prototype.slice.call(arguments),n="Object";e[e.length-1]===!0&&(n="Array",e.pop());var a=n+e.join("");if(t[a])return t[a];var o=r.$inst.apply(this,e)["$as"+n]();return t[a]=o,o},r.$load=function(){return r.$get.apply(this,arguments).$loaded()},r.$child=function(){var r=Array.prototype.slice.call(arguments),t=r.shift();return angular.isFunction(t.$inst)&&(t=t.$inst()),angular.isFunction(t.$ref)&&(t=t.$ref()),angular.isFunction(t.child)?e(t.child(r.join("/"))):t},r.$intersect=function(t,n){return e(Firebase.util.intersection(r.$ref(t),r.$ref(n))).$asArray()},r}]),angular.module("drumbeats",["firebase","firebaseHelper"]).controller("AppCtrl",["$scope","$rootScope","$firebaseHelper",function(e,r){r.console=console}]).controller("BeatCtrl",["$scope","$rootScope","$timeout",function(e,r){e.beat={name:"Beginner",beatsPerBar:4,beatUnit:16,barsPerMeasure:2,channels:[{name:"Bass",notes:[3,7,11,15]},{name:"HiHat",notes:[1,2,3,4,5,6,7,8,9,10,11,12,13,14]},{name:"Snare",notes:[1,5,9,13]},{name:"Ride"},{name:"Crash"},{name:"HiTom"},{name:"LoTom"},{name:"FloorTom"}]};var t=function(e){return e.beatsPerBar*e.barsPerMeasure},n=function(r){e.spots=[];for(var n=1;n<t(r)+1;n+=r.beatsPerBar/r.beatUnit)e.spots.push(n)};n(e.beat);var a=function(r){e.guides=[];for(var n=1;n<t(r)+1;n+=r.beatsPerBar/r.beatUnit)e.guides.push((n-1)%r.beatsPerBar?-n:n)};a(e.beat),e.$watch("beat.beatsPerBar",function(){n(e.beat),a(e.beat)}),e.$watch("beat.beatUnit",function(){n(e.beat),a(e.beat)});var o=function(e){var r=0;angular.forEach(e.channels,function(e){r=Math.max(r,e.notes?Math.max.apply(null,e.notes)-1:0)});var n=t(e);return r=r-r%n+(r%n>0&&n)};o(e.beat),e.getMeasures=function(e,r){for(var n=[],a=1;a<=o(e)/t(e)+(r?1:0);a++)n.push(a);return n};var s=function(){return+new Date},i=r.$marker={measure:1,position:0,$bpm:90,bpm:function(e){return e&&(i.$bpm=e),i.$bpm},$start:s(),$playing:!1,play:function(e){e&&i.bpm(e),i.$playing=!0,i.$start=s()-(i.$paused||0),requestAnimationFrame(i.$refresh)},pause:function(){i.$playing=!1,i.$paused=s()-i.$start},stop:function(){i.$start=s()+1e3,i.$playing=!1,i.$paused=0},$refresh:function(){e.$apply(function(){var r=s()-i.$start;period=6e4/i.$bpm*t(e.beat),i.measure=Math.floor(r/period)+1,i.position=Math.min(Math.max(0,r%period/period),1)}),i.$playing&&requestAnimationFrame(i.$refresh)}};i.play(),e.progress=function(e,r){return(Math.abs(e)-1)%t(r)/t(r)},e.lyric=function(e,r,t){var n=(Math.abs(e)-1)%1;return 0==n?t?"note":(Math.abs(e)-1)%r.beatsPerBar+1:.25>=n?"e":n>=2/3?"a":t?"and":"&"},e.addNote=function(r,n,a){r.notes||(r.notes=[]);var o=a+(n-1)*t(e.beat);r.notes.push(o)},e.alterNote=function(e,r){var t=e.notes.indexOf(r);t>=0&&(e.notes[t]=-e.notes[t])},e.removeNote=function(e,r){e.notes||(e.notes=[]);var t=e.notes.indexOf(r);t>=0&&e.notes.splice(t,1)},e.shiftNotes=function(r){r&&angular.forEach(e.beat.channels,function(e){angular.forEach(e.notes,function(t,n){e.notes[n]+=r})})}}]).filter("filterNotesByMeasure",function(){return function(e,r,t){if(!e)return e;var n=(t-1)*r.beatsPerBar*r.barsPerMeasure,a=(t-0)*r.beatsPerBar*r.barsPerMeasure;return e.filter(function(e){return e>n+1&&a+1>e})}});