angular.module("firebaseHelper",["firebase"]).service("$firebaseHelper",["$firebase",function(e){var r=this,t={};return r.$ref=function(){var e=Array.prototype.slice.call(arguments);"constants"!=e[0]&&e.unshift("data");var r="Ref"+e.join("");if(t[r])return t[r];var n=new Firebase("https://ripkit.firebaseio.com/"+(e.join("/")||""));return t[r]=n,n},r.$inst=function(){var n=Array.prototype.slice.call(arguments),a="Inst"+n.join("");if(t[a])return t[a];var i=e(r.$ref.apply(this,arguments));return t[a]=i,i},r.$get=function(){var e=Array.prototype.slice.call(arguments),n="Object";e[e.length-1]===!0&&(n="Array",e.pop());var a=n+e.join("");if(t[a])return t[a];var i=r.$inst.apply(this,e)["$as"+n]();return t[a]=i,i},r.$load=function(){return r.$get.apply(this,arguments).$loaded()},r.$child=function(){var r=Array.prototype.slice.call(arguments),t=r.shift();return angular.isFunction(t.$inst)&&(t=t.$inst()),angular.isFunction(t.$ref)&&(t=t.$ref()),angular.isFunction(t.child)?e(t.child(r.join("/"))):t},r.$intersect=function(t,n){return e(Firebase.util.intersection(r.$ref(t),r.$ref(n))).$asArray()},r}]),angular.module("drumbeats",["firebase","firebaseHelper"]).controller("AppCtrl",["$scope","$rootScope","$firebaseHelper",function(e,r){r.console=console,r.editing=!1}]).controller("BeatCtrl",["$scope","$rootScope","$timeout",function(e,r){e.$channels=[{".priority":1,$id:"bass",name:"Bass"},{".priority":2,$id:"hihat",name:"HiHat"},{".priority":3,$id:"snare",name:"Snare"},{".priority":4,$id:"ride",name:"Ride"},{".priority":5,$id:"crash",name:"Crash"},{".priority":6,$id:"hitom",name:"Hi Tom"},{".priority":7,$id:"lotom",name:"Lo Tom"},{".priority":8,$id:"floortom",name:"Floor Tom"}],e.beat={name:"Beginner",beatsPerBar:4,barsPerLine:2,channels:{bass:[3,7,11,15],hihat:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],snare:[1,5,9,13]}},e.beats=[e.beat];var t=function(e){return e.beatsPerBar*e.barsPerLine},n=function(e){return e.beatsPerBar%4==0?.25:e.beatsPerBar%3==0?1/3:.5},a=function(e){for(var r=[],t=n(e),a=0;a<e.barsPerLine/n(e)*e.beatsPerBar;a++){var i=a*t+1;r.push(i)}return r};e.$watchCollection("beat",function(){e.guides=a(e.beat)});var i=function(e){var r=0;angular.forEach(e.channels,function(e){r=Math.max(r,e?Math.max.apply(null,e)-1:0)});var n=t(e);return r=r-r%n+(r%n>0&&n)};e.getMeasures=function(e,r){for(var n=[],a=1;a<=i(e)/t(e)+(r?1:0);a++)n.push(a);return n};var o=function(){return+new Date},s=r.$marker={measure:1,position:0,$bpm:90,bpm:function(e){return e&&(s.$bpm=e),s.$bpm},$start:o(),$playing:!1,play:function(e){e&&s.bpm(e),s.$playing=!0,s.$start=o()-(s.$paused||0),requestAnimationFrame(s.$refresh)},pause:function(){s.$playing=!1,s.$paused=o()-s.$start},stop:function(){s.$start=o()+1e3,s.$playing=!1,s.$paused=0},$refresh:function(){e.$apply(function(){var r=o()-s.$start,n=6e4/s.$bpm*t(e.beat);s.position=Math.min(Math.max(0,r%n/n),1);var a=e.getMeasures(e.beat,e.editing).length,i=Math.floor(r/n)+1;s.measure=i>a?(i+1)%a+1:i}),s.$playing&&requestAnimationFrame(s.$refresh)}};s.play(),e.progress=function(e,r){return(Math.abs(e)-1)%t(r)/t(r)},e.lyric=function(e,r){var t=(n(r),e-parseInt(e));return t>0&&.2525>=t?"e":t>=.33&&.505>=t?"&":t>=199/300?"a":(e-1)%r.beatsPerBar+1},e.addNote=function(r,n,a){r||(r=[]);var i=a+(n-1)*t(e.beat);r.push(i)},e.alterNote=function(e,r){var t=e.indexOf(r);t>=0&&(e[t]=-e[t])},e.removeNote=function(e,r){e||(e=[]);var t=e.indexOf(r);t>=0&&e.splice(t,1)}}]).filter("filterNotesByMeasure",function(){return function(e,r,t){if(!e)return e;var n=(t-1)*r.beatsPerBar*r.barsPerLine,a=(t-0)*r.beatsPerBar*r.barsPerLine;return e.filter(function(e){return e>=n+1&&a+1>e})}}).directive("ngResize",["$window",function(e){return function(r,t,n){var a=function(a){r.$eval(n.ngResize,{$width:t[0].offsetWidth,$height:t[0].offsetHeight,$vw:e.innerWidth,$vh:e.innerHeight,$event:a})};angular.element(e).on("resize",a).on("load",a)}}]);